# REDES NEURONALES

**MLP**

```bash
    # Backpropagation — Teoría completa + ejemplo numérico en ASCII

X=[1,0]   y=1   lr=0.5

W1=[[0.5,-0.3],[0.4,0.6]]   b1=[0.1,0.2]
W2=[[0.7],[-0.5]]            b2=[-0.3]

══════════════════════════════════════════════════════
FORWARD
══════════════════════════════════════════════════════

          X=[1,0]
             │
             │  z1 = X @ W1 + b1
             ▼
    z1[0] = 0.5*1 + 0.4*0 + 0.1 = 0.6
    z1[1] =-0.3*1 + 0.6*0 + 0.2 =-0.1
             │
             │  a1 = sigmoid(z1)
             │
             │  sigmoid(z) = 1 / (1 + e^-z)
             ▼
    a1[0] = 1/(1+e^-0.6) = 0.6457
    a1[1] = 1/(1+e^0.1)  = 0.4750
             │
             │  z2 = a1 @ W2 + b2
             ▼
    z2 = 0.7*0.6457 + (-0.5)*0.4750 + (-0.3)
       = 0.4520 - 0.2375 - 0.3
       =-0.0855
             │
             │  a2 = sigmoid(z2)
             ▼
    a2 = 1/(1+e^0.0855) = 0.4786   ← prediccion
             │
             │  L = (y - a2)²
             ▼
    L = (1 - 0.4786)² = (0.5214)² = 0.2719

    El modelo predijo 0.4786 cuando debía predecir 1.
    Hay que corregir los pesos → BACKWARD

══════════════════════════════════════════════════════
BACKWARD — regla de la cadena
══════════════════════════════════════════════════════

    Para llegar a dL/dW hay que recorrer el grafo hacia atrás:

    dL/dW2 = dL/da2 * da2/dz2 * dz2/dW2
                ↑         ↑         ↑
           deriv MSE  deriv sig  deriv lineal

─────────────────────────────────────────────
DERIVADA DE SIGMOID  (necesaria en cada capa)
─────────────────────────────────────────────

    sigmoid(z) = 1 / (1 + e^-z)

    d/dz sigmoid(z) = e^-z / (1+e^-z)²
                    = sigmoid(z) * (1 - sigmoid(z))
                    = a * (1-a)

    Solo necesitamos a, no hace falta z.
    Por eso el código guarda a1 y a2.

─────────────────────────────────────────────
CAPA SALIDA — delta2
─────────────────────────────────────────────

    ┌─────────────────────────────────────────┐
    │  dL/da2                                 │
    │                                         │
    │  L = (y-a2)²                            │
    │  dL/da2 = -2(y-a2)                      │
    │                                         │
    │  el 2 se absorbe en lr, simplificamos:  │
    │  dL/da2 = -(y-a2)                       │
    │                                         │
    │  numerico:                              │
    │  dL/da2 = -(1-0.4786) = -0.5214         │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  da2/dz2                                │
    │                                         │
    │  a2 = sigmoid(z2)                       │
    │  da2/dz2 = a2*(1-a2)                    │
    │                                         │
    │  numerico:                              │
    │  da2/dz2 = 0.4786*(1-0.4786)            │
    │          = 0.4786*0.5214                │
    │          = 0.2496                       │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  delta2 = dL/dz2                        │
    │         = dL/da2 * da2/dz2             │
    │         = -(y-a2) * a2*(1-a2)          │
    │                                         │
    │  delta2 es el gradiente acumulado       │
    │  hasta z2. nombre por convencion        │
    │  pero matematicamente es dL/dz2         │
    │                                         │
    │  nota: usamos (y-a2) con +=            │
    │        en lugar de -(y-a2) con -=      │
    │        da lo mismo                     │
    │                                         │
    │  numerico:                              │
    │  delta2 = 0.5214 * 0.2496 = 0.1301     │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  dz2/dW2                                │
    │                                         │
    │  z2 = a1 @ W2 + b2                      │
    │  dz2/dW2 = a1                           │
    │                                         │
    │  numerico:                              │
    │  dz2/dW2 = a1 = [0.6457, 0.4750]        │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  dL/dW2 = dL/dz2 * dz2/dW2             │
    │         = delta2 * a1                   │
    │         = a1.T @ delta2                 │
    │                                         │
    │  numerico:                              │
    │  dL/dW2[0] = 0.6457 * 0.1301 = 0.0840  │
    │  dL/dW2[1] = 0.4750 * 0.1301 = 0.0618  │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  dL/db2                                 │
    │                                         │
    │  z2 = a1 @ W2 + b2                      │
    │  dz2/db2 = 1                            │
    │                                         │
    │  dL/db2 = delta2 * 1 = delta2           │
    │                                         │
    │  numerico:                              │
    │  dL/db2 = 0.1301                        │
    └─────────────────────────────────────────┘
             │
             ▼
    ACTUALIZAR W2 y b2  (lr=0.5):

    W2[0] += 0.5 * 0.0840 = +0.0420 → 0.7000 + 0.0420 = 0.7420
    W2[1] += 0.5 * 0.0618 = +0.0309 → -0.5000 + 0.0309 = -0.4691
    b2    += 0.5 * 0.1301 = +0.0651 → -0.3000 + 0.0651 = -0.2349

─────────────────────────────────────────────
CAPA OCULTA — delta1
─────────────────────────────────────────────

    ┌─────────────────────────────────────────┐
    │  dL/da1                                 │
    │                                         │
    │  el error llega a a1 a traves de z2     │
    │  z2 = a1 @ W2 + b2                      │
    │  dz2/da1 = W2                           │
    │                                         │
    │  dL/da1 = delta2 @ W2.T                 │
    │                                         │
    │  numerico:                              │
    │  dL/da1[0] = 0.1301 *  0.7   =  0.0911 │
    │  dL/da1[1] = 0.1301 * (-0.5) = -0.0651 │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  da1/dz1                                │
    │                                         │
    │  a1 = sigmoid(z1)                       │
    │  da1/dz1 = a1*(1-a1)                    │
    │                                         │
    │  numerico:                              │
    │  da1/dz1[0] = 0.6457*(1-0.6457)         │
    │             = 0.6457*0.3543 = 0.2289    │
    │  da1/dz1[1] = 0.4750*(1-0.4750)         │
    │             = 0.4750*0.5250 = 0.2494    │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  delta1 = dL/da1 * da1/dz1             │
    │         = (delta2 @ W2.T) * a1*(1-a1)  │
    │                                         │
    │  numerico:                              │
    │  delta1[0] =  0.0911 * 0.2289 =  0.0208│
    │  delta1[1] = -0.0651 * 0.2494 = -0.0162│
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  dL/dW1                                 │
    │                                         │
    │  z1 = X @ W1 + b1                       │
    │  dz1/dW1 = X                            │
    │                                         │
    │  dL/dW1 = X.T @ delta1                  │
    │                                         │
    │  numerico  (X=[1,0]):                   │
    │  dL/dW1[0][0] = 1 *  0.0208 =  0.0208  │
    │  dL/dW1[0][1] = 1 * -0.0162 = -0.0162  │
    │  dL/dW1[1][0] = 0 *  0.0208 =  0.0000  │
    │  dL/dW1[1][1] = 0 * -0.0162 =  0.0000  │
    └─────────────────────────────────────────┘
             │
             ▼
    ┌─────────────────────────────────────────┐
    │  dL/db1                                 │
    │                                         │
    │  z1 = X @ W1 + b1                       │
    │  dz1/db1 = 1                            │
    │                                         │
    │  dL/db1 = delta1 * 1 = delta1           │
    │                                         │
    │  numerico:                              │
    │  dL/db1[0] =  0.0208                    │
    │  dL/db1[1] = -0.0162                    │
    └─────────────────────────────────────────┘
             │
             ▼
    ACTUALIZAR W1 y b1  (lr=0.5):

    W1[0][0] += 0.5 *  0.0208 = +0.0104 → 0.5000 + 0.0104 = 0.5104
    W1[0][1] += 0.5 * -0.0162 = -0.0081 → -0.3000 - 0.0081 = -0.3081
    W1[1][0] += 0.5 *  0.0000 =  0.0000 → 0.4000
    W1[1][1] += 0.5 *  0.0000 =  0.0000 → 0.6000
    b1[0]    += 0.5 *  0.0208 = +0.0104 → 0.1000 + 0.0104 = 0.1104
    b1[1]    += 0.5 * -0.0162 = -0.0081 → 0.2000 - 0.0081 = 0.1919

══════════════════════════════════════════════════════
RESUMEN COMPLETO
══════════════════════════════════════════════════════

    X=[1,0]
       │
       │  z1=X@W1+b1
       ▼
    z1=[0.6, -0.1]
       │
       │  a1=sigmoid(z1)=a*(1-a)
       ▼
    a1=[0.6457, 0.4750]
       │
       │  z2=a1@W2+b2
       ▼
    z2=-0.0855
       │
       │  a2=sigmoid(z2)
       ▼
    a2=0.4786  ← prediccion
       │
       │  L=(y-a2)²=0.2719
       ▼
    ◄──────────────────────── BACKWARD
       │
       │  dL/da2=-(y-a2)=-0.5214
       │  da2/dz2=a2*(1-a2)=0.2496
       │  delta2=(y-a2)*a2*(1-a2)=0.1301
       │  dL/dW2=a1.T@delta2=[0.0840, 0.0618]
       │  dL/db2=0.1301
       │
       │  dL/da1=delta2@W2.T=[0.0911,-0.0651]
       │  da1/dz1=a1*(1-a1)=[0.2289, 0.2494]
       │  delta1=dL/da1*da1/dz1=[0.0208,-0.0162]
       │  dL/dW1=X.T@delta1
       │  dL/db1=delta1=[0.0208,-0.0162]
       ▼
    PESOS ACTUALIZADOS:
    W2: [ 0.7420, -0.4691]   b2: -0.2349
    W1: [[0.5104, -0.3081],  b1: [0.1104, 0.1919]
         [0.4000,  0.6000]]

    Esto se repite 10000 veces con las 4 muestras XOR
    hasta que a2 converge a [0,1,1,0].
```